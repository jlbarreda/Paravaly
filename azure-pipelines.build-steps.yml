# https://aka.ms/yaml

steps:
- task: knom.regexreplace-task.regex-replace.RegexReplace@3
  displayName: 'Set Version'
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  inputs:
    InputSearchPattern: 'src\**\*.csproj'
    FindRegex: '<VersionPrefix></VersionPrefix>'
    ReplaceRegex: '<VersionPrefix>$(version)</VersionPrefix>'

- script: |
    dotnet build --configuration $(buildConfiguration)
    dotnet test test\Paravaly.Tests\Paravaly.Tests.csproj --configuration $(buildConfiguration) --logger trx --no-build
    dotnet pack src\Paravaly

- task: PublishTestResults@2
  condition: succeededOrFailed()
  inputs:
    testRunner: VSTest
    testResultsFiles: '**/*.trx'